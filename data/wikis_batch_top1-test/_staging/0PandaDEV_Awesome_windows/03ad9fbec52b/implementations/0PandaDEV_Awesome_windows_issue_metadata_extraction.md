# Implementation: Issue_metadata_extraction

{| class="wikitable" style="float:right; margin-left:1em; width:300px;"
|-
! Knowledge Sources
|
* [[source::Repo|Awesome Windows|https://github.com/0PandaDEV/awesome-windows]]
* [[source::Doc|GitHub Script Action|https://github.com/actions/github-script]]
* [[source::Doc|GNU awk|https://www.gnu.org/software/gawk/manual/gawk.html]]
|-
! Domains
| [[domain::GitHub_Actions]], [[domain::Text_Parsing]], [[domain::Shell_Scripting]]
|-
! Last Updated
| [[last_updated::2026-01-08 18:30 GMT]]
|}

== Overview ==

External tool document for extracting structured metadata from GitHub Issue bodies using github-script and awk.

=== Description ===

This workflow step combines the `actions/github-script` action to fetch issue details via the GitHub API with `awk` commands to parse the structured issue body. The issue body format (generated by Issue Forms) uses `### Field Name` headers, allowing awk to extract values between headers into shell variables.

=== Usage ===

Use this pattern when you need to extract structured data from GitHub Issue bodies created by Issue Forms. The two-phase approach (API fetch + awk parsing) separates concerns: JavaScript for API access, shell for text processing.

== Code Reference ==

=== Source Location ===
* '''Repository:''' [https://github.com/0PandaDEV/awesome-windows awesome-windows]
* '''File:''' .github/workflows/covert_to_pr.yml
* '''Lines:''' L28-51

=== Signature ===
<syntaxhighlight lang="yaml">
- name: Get issue details
  id: issue
  uses: actions/github-script@v7
  with:
    github-token: ${{ secrets.PAT }}
    script: |
      const issueNumber = context.payload.inputs
        ? context.payload.inputs.issue_number
        : context.issue.number;
      const issue = await github.rest.issues.get({
        owner: context.repo.owner,
        repo: context.repo.repo,
        issue_number: issueNumber
      });
      return issue.data;

- name: Update README.md
  run: |
    ISSUE_BODY="${{ fromJson(steps.issue.outputs.result).body }}"

    # awk pattern: /### Field Name/{flag=1; next} /###/{flag=0} flag
    APP_NAME=$(echo "$ISSUE_BODY" | awk '/### Application Name/{flag=1; next} /###/{flag=0} flag' | xargs)
    APP_URL=$(echo "$ISSUE_BODY" | awk '/### Application URL/{flag=1; next} /###/{flag=0} flag' | xargs)
    CATEGORY=$(echo "$ISSUE_BODY" | awk '/### Category/{flag=1; next} /###/{flag=0} flag' | xargs)
    APP_DESCRIPTION=$(echo "$ISSUE_BODY" | awk '/### Description/{flag=1; next} /###/{flag=0} flag' | xargs)
    REPO_URL=$(echo "$ISSUE_BODY" | awk '/### Repository URL/{flag=1; next} /###/{flag=0} flag' | xargs)
</syntaxhighlight>

=== Import ===
<syntaxhighlight lang="yaml">
- uses: actions/github-script@v7
  with:
    github-token: ${{ secrets.PAT }}
</syntaxhighlight>

== I/O Contract ==

=== Inputs ===
{| class="wikitable"
|-
! Name !! Type !! Required !! Description
|-
| issue_number || number || Yes || From context or workflow_dispatch input
|-
| secrets.PAT || str || Yes || GitHub token for API access
|-
| Issue body || markdown || Yes || Structured body with `### Field` headers
|}

=== Outputs ===
{| class="wikitable"
|-
! Name !! Type !! Description
|-
| APP_NAME || str (env) || Extracted application name
|-
| APP_URL || str (env) || Extracted application URL
|-
| CATEGORY || str (env) || Extracted category name
|-
| APP_DESCRIPTION || str (env) || Extracted description text
|-
| REPO_URL || str (env) || Extracted repository URL (may be empty)
|}

== Usage Examples ==

=== awk Pattern Explanation ===
<syntaxhighlight lang="awk">
# Pattern: /### Field Name/{flag=1; next} /###/{flag=0} flag

# /### Application Name/  - When this line is found
#   {flag=1; next}        - Set flag, skip to next line

# /###/                   - When any ### line is found
#   {flag=0}              - Clear flag (stop capturing)

# flag                    - Print line if flag is set

# Combined effect: Print all lines BETWEEN "### Application Name" and next "###"
</syntaxhighlight>

=== Complete Extraction Flow ===
<syntaxhighlight lang="bash">
# Issue body example:
# ### Application Name
# Visual Studio Code
# ### Application URL
# https://code.visualstudio.com
# ### Category
# IDEs

ISSUE_BODY="..."  # From github-script output

# Extract each field (| xargs trims whitespace)
APP_NAME=$(echo "$ISSUE_BODY" | awk '/### Application Name/{flag=1; next} /###/{flag=0} flag' | xargs)
# Result: "Visual Studio Code"

APP_URL=$(echo "$ISSUE_BODY" | awk '/### Application URL/{flag=1; next} /###/{flag=0} flag' | xargs)
# Result: "https://code.visualstudio.com"

CATEGORY=$(echo "$ISSUE_BODY" | awk '/### Category/{flag=1; next} /###/{flag=0} flag' | xargs)
# Result: "IDEs"
</syntaxhighlight>

=== GitHub Script API Call ===
<syntaxhighlight lang="javascript">
// Fetch issue data via GitHub REST API
const issueNumber = context.payload.inputs
  ? context.payload.inputs.issue_number  // Manual dispatch
  : context.issue.number;                 // Comment trigger

const issue = await github.rest.issues.get({
  owner: context.repo.owner,
  repo: context.repo.repo,
  issue_number: issueNumber
});

return issue.data;  // Contains .body, .title, .labels, etc.
</syntaxhighlight>

== Related Pages ==

=== Implements Principle ===
* [[implements::Principle:0PandaDEV_Awesome_windows_Issue_Body_Parsing]]

=== Requires Environment ===
* [[requires_env::Environment:0PandaDEV_Awesome_windows_GitHub_Actions_Ubuntu]]
