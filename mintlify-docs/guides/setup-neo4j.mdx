---
title: "Setup Neo4j"
description: "Configure the knowledge graph database"
---

The knowledge graph uses Neo4j to store domain expertise. This guide covers setup and data loading.

## Quick Start

<Steps>
  <Step title="Start Neo4j container">
    ```bash
    docker run -d \
        --name neo4j \
        --restart unless-stopped \
        -p 7474:7474 -p 7687:7687 \
        -e NEO4J_AUTH=neo4j/password \
        neo4j:latest
    ```
  </Step>
  <Step title="Configure environment">
    Add to `.env`:
    ```bash
    NEO4J_URI=bolt://localhost:7687
    NEO4J_USER=neo4j
    NEO4J_PASSWORD=password
    ```
  </Step>
  <Step title="Load knowledge data">
    ```bash
    PYTHONPATH=. python -c "
    from src.knowledge.search.kg_llm_navigation_search import KGLLMNavigationSearch
    import json
    
    search = KGLLMNavigationSearch()
    with open('benchmarks/mle/data/kg_data.json') as f:
        search.index(json.load(f))
    print('Knowledge graph loaded successfully')
    "
    ```
  </Step>
  <Step title="Verify">
    Open http://localhost:7474 in your browser.
    
    Run query:
    ```cypher
    MATCH (n) RETURN count(n) as nodeCount
    ```
  </Step>
</Steps>

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `NEO4J_URI` | `bolt://localhost:7687` | Connection URI |
| `NEO4J_USER` | `neo4j` | Username |
| `NEO4J_PASSWORD` | `password` | Password |

## Docker Options

### Persistent Storage

```bash
docker run -d \
    --name neo4j \
    --restart unless-stopped \
    -p 7474:7474 -p 7687:7687 \
    -e NEO4J_AUTH=neo4j/password \
    -v neo4j_data:/data \
    neo4j:latest
```

### Custom Password

```bash
docker run -d \
    --name neo4j \
    -p 7474:7474 -p 7687:7687 \
    -e NEO4J_AUTH=neo4j/mysecurepassword \
    neo4j:latest
```

Update `.env` accordingly.

### Memory Settings

```bash
docker run -d \
    --name neo4j \
    -p 7474:7474 -p 7687:7687 \
    -e NEO4J_AUTH=neo4j/password \
    -e NEO4J_dbms_memory_heap_max__size=2G \
    neo4j:latest
```

## Knowledge Data Format

The knowledge graph expects JSON with nodes and edges:

```json
{
  "nodes": {
    "0": {
      "id": "0",
      "name": "Kaggle competitions",
      "type": "specialization",
      "content": "Tips for solving Kaggle competitions..."
    },
    "1": {
      "id": "1",
      "name": "Text Classification",
      "type": "workflow",
      "content": "Best approaches for text classification..."
    }
  },
  "edges": [
    {"source": "0", "target": "1"},
    {"source": "1", "target": "2", "relationship": "HAS_CONCEPT"}
  ]
}
```

### Node Types

| Type | Purpose |
|------|---------|
| `specialization` | Root category |
| `workflow` | Step-by-step approach |
| `concept` | Detailed tips |
| `code` | Code examples |

## Verify Connection

```python
from neo4j import GraphDatabase

driver = GraphDatabase.driver(
    "bolt://localhost:7687",
    auth=("neo4j", "password")
)

with driver.session() as session:
    result = session.run("MATCH (n) RETURN count(n) as count")
    print(f"Nodes: {result.single()['count']}")

driver.close()
```

## Troubleshooting

<Accordion title="Container won't start">
Check logs:
```bash
docker logs neo4j
```

Common issues:
- Port already in use: Stop conflicting containers
- Memory: Reduce heap size or increase Docker memory
</Accordion>

<Accordion title="Connection refused">
1. Wait 30-60 seconds for Neo4j to initialize
2. Check container status: `docker ps`
3. Verify ports: `docker port neo4j`
</Accordion>

<Accordion title="Authentication failed">
1. Verify password in `NEO4J_AUTH` environment variable
2. Check `.env` file matches container settings
3. Reset: `docker rm -f neo4j` and recreate
</Accordion>

## Disable Knowledge Graph

If you don't need the knowledge graph:

```bash
# CLI flag
PYTHONPATH=. python -m benchmarks.mle.runner -c competition --no-kg
```

Or in config:
```yaml
knowledge_search:
  enabled: false
```

