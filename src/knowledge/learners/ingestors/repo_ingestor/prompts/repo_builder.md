# Repository Builder Phase: Create GitHub Repositories for Workflows

You are a Code Generation Agent. Your task is to create GitHub repositories for each workflow by building professional, executable implementations from the WorkflowIndex.

## ‚ö†Ô∏è FILE PLACEMENT RULES (CRITICAL)

**Only modify/create files in these locations:**
- `{wiki_dir}/workflows/` - Update Workflow pages with GitHub URLs
- `{wiki_dir}/_WorkflowIndex.md` - Update with GitHub URLs
- `{wiki_dir}/_reports/` - Execution reports

**DO NOT create:**
- Summary files at the root of `{wiki_dir}`
- Documentation files outside the designated directories
- "Notes", "summaries", or "completion reports" outside `_reports/`

## Context

- Repository: {repo_name}
- Repository Path: {repo_path}
- Wiki Output Directory: {wiki_dir}
- **WorkflowIndex (CRITICAL):** {wiki_dir}/_WorkflowIndex.md
- Workflow Pages: {wiki_dir}/workflows/

## Your Task

For EACH workflow in the WorkflowIndex:

1. **Read the enriched WorkflowIndex** to get step implementation details
2. **Build a professional Python repository** with:
   - One Python file per step (`step_01_*.py`, `step_02_*.py`, etc.)
   - `requirements.txt` with pinned dependencies
   - `README.md` with setup and usage instructions
   - `run_workflow.py` - orchestrates all steps
   - `.gitignore` for Python projects
3. **Push to GitHub** as a private repository
4. **Update the Workflow page** with the GitHub URL

## Step 1: Read WorkflowIndex

Read `{wiki_dir}/_WorkflowIndex.md` and for each workflow, extract:

- **Workflow name** (e.g., `{repo_name}_QLoRA_Finetuning`)
- **Description** (one-line summary)
- **Steps** with detailed implementation context:
  - API Call
  - Source Location  
  - External Dependencies
  - Key Parameters
  - Inputs/Outputs

## Step 2: Generate Repository Structure

For each workflow, create files with this structure:

```
workflow-{sanitized-name}/
‚îú‚îÄ‚îÄ step_01_{step_name}.py
‚îú‚îÄ‚îÄ step_02_{step_name}.py
‚îú‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ run_workflow.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ __init__.py
‚îî‚îÄ‚îÄ .gitignore
```

### Step File Template

Each step file should:
- Import necessary libraries
- Define a main function implementing the step
- Include docstrings with parameter descriptions
- Have a `main()` entry point for standalone testing

```python
"""
Step N: {Step_Name}

This module implements the {Step_Name} step.

API Reference: {API_Call}
Source Location: {Source_Location}
"""

import logging
from typing import Any, Dict, Optional

# External imports based on dependencies
{imports}

logger = logging.getLogger(__name__)


def {step_function}(
    # Parameters from WorkflowIndex
    **kwargs,
) -> Any:
    """
    Execute the {Step_Name} step.
    
    Args:
        {key_parameters}
    
    Returns:
        {outputs}
    """
    logger.info("Starting {Step_Name}...")
    
    # Implementation based on source code reference
    # Reference: {source_location}
    
    # TODO: Implement step logic
    raise NotImplementedError(
        "Refer to {source_location} for implementation"
    )


def main():
    """Run this step standalone."""
    import argparse
    parser = argparse.ArgumentParser()
    # Add arguments
    args = parser.parse_args()
    result = {step_function}()
    print(f"Result: {{result}}")


if __name__ == "__main__":
    main()
```

### requirements.txt Template

```
# Auto-generated requirements for {workflow_name}

{dependencies_with_versions}
```

### README.md Template

```markdown
# {Workflow_Name}

{Description}

## Source Repository

Derived from: `{repo_namespace}`

## Installation

\```bash
git clone <this-repo-url>
cd <repo-name>
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
\```

## Steps

1. **{Step_1}**: {description}
2. **{Step_2}**: {description}
...

## Usage

\```bash
# Run individual steps
python step_01_*.py --help

# Run full workflow
python run_workflow.py
\```

## Generated

Auto-generated by Praxium on {date}
```

### run_workflow.py Template

```python
"""
{Workflow_Name} - Full Workflow Runner
"""

import argparse
import logging

{step_imports}

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


def run_workflow(args):
    """Execute all steps in order."""
    {step_calls}


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--continue-on-error", action="store_true")
    args = parser.parse_args()
    run_workflow(args)


if __name__ == "__main__":
    main()
```

## Step 3: Create GitHub Repository

For each workflow:

1. **Sanitize repo name**: Convert `{repo_name}_Workflow_Name` to `workflow-{repo-name}-workflow-name`
2. **Create private repository** via GitHub API
3. **Push generated files** to the repository
4. **Get repository URL**

## Step 4: Update Workflow Pages

For each workflow page in `{wiki_dir}/workflows/`:

1. **Find the `== GitHub URL ==` section**
2. **Replace the PENDING placeholder** with the actual URL:

```mediawiki
== GitHub URL ==

The executable implementation is available at:

[[github_url::https://github.com/praxium/workflow-{sanitized-name}]]

'''Repository Structure:'''
* `step_01_{name}.py` - {description}
* `step_02_{name}.py` - {description}
* ...
* `requirements.txt` - Pinned dependencies
* `README.md` - Setup instructions
```

## Step 5: Update WorkflowIndex

Update `{wiki_dir}/_WorkflowIndex.md`:

1. **Update the Summary table** with GitHub URLs
2. **Update each workflow section** with the URL

## Repo Scoping Rule (CRITICAL)

Only process workflows whose names start with `{repo_name}_`.

## ‚ö†Ô∏è File Editing Tip

When updating files:
- **Use Write tool** (read entire file ‚Üí modify ‚Üí write back)
- **Avoid Edit tool** ‚Äî it often fails on markdown

## üìù Execution Report (REQUIRED)

When finished, write a summary report to `{wiki_dir}/_reports/phase_repo_builder.md`:

```markdown
# Repository Builder Report

## Summary
- Workflows processed: X
- Repositories created: X
- Repositories updated: X

## Repositories Created

| Workflow | Repository URL | Steps | Status |
|----------|----------------|-------|--------|
| {name} | https://github.com/... | X | ‚úÖ Created |

## Files Generated Per Repository

### workflow-{name}
- `step_01_*.py` - {description}
- `step_02_*.py` - {description}
- `requirements.txt` - X dependencies
- `README.md` - Setup instructions

## Workflow Pages Updated
- {workflow_name}.md - GitHub URL added

## Notes
- [Any issues encountered]
- [Dependencies that couldn't be resolved]
```
